---
title: "Assignment 5"
author: "Matthew Tillmawitz"
date: "2024-09-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
```

## Read in data

The data is read in from the csv that was created and can be viewed in the github repository this project resides in. Some filtering is done to remove empty rows in the csv and fill the airline name in.

```{r read}
raw_data <- read_csv("flights.csv")
marshal <- raw_data |>
  filter(!if_all(names(raw_data), ~ is.na(.))) |>
  fill(...1) |>
  rename(airline = ...1, status = ...2)
marshal
```

## Cleaning Up the Data

In order to make analysis easier, the destinations are collapsed into a single column named "destination" and the number of flights in each cell is mapped to a column named "flights". The "status" column is then broken out into two columns, "on_time" and "delayed" with the value of the "flights" column mapped to the corresponding status. This data format makes calculating the rate of on time flights simple for each airline and destination.

```{r initial cleanup}
pivoted <- marshal |>
  pivot_longer(
    cols = `Los Angeles`:Seattle,
    names_to = "destination",
    values_to = "flights"
  ) |>
  pivot_wider(
    names_from = status,
    values_from = flights
  ) |>
  rename(on_time = `on time`) |>
  mutate(total_flights = on_time + delayed, on_time_percentage = on_time / total_flights)

pivoted
```

## Plotting the Data

By plotting the rate of on time flights it can be seen that Alaska has a consistently higher rate of on time flights for every destination. The difference is most notable for San Francisco and Seattle, with both having around a 10% difference in the rate of on time flights.

```{r proportion_compare}
pivoted |>
  ggplot(aes(x = destination, y = on_time_percentage, fill = airline)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "City", y = "On Time Rate", fill = "Airline", title = "Comparing Airline On Time Rates by Destination")
```

In order to give the previous graph context, it is necessary to also look at the total number of flights to each destination by the airlines. Alaska has fewer flights overall in the sample, but does have a larger number of flights going to Seattle and San Francisco. It should be noted that the prior graph showed these airports had the largest difference in on time rates as well, with Alaska having the better rate. The two destinations with the most significant differences in total flights were Phoenix and Seattle with Am West and Alaska leading at the respective destinations.

```{r total comparison}
pivoted |>
  ggplot(aes(x = destination, y = total_flights, fill = airline)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "City", y = "Flights", fill = "Airline", title = "Total Flights to Destinations by Airline")
```

